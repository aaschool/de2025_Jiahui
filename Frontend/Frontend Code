import React, { useState } from "react";
import { View, Text, TextInput, Button, TouchableOpacity, StyleSheet, Image } from "react-native";
import { createStackNavigator } from "@react-navigation/stack";
import { NavigationContainer } from "@react-navigation/native";

const Stack = createStackNavigator();

// Login Page
function LoginScreen({ navigation }) {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  return (
    <View style={styles.container}>
      <Image source={require("./assets/aa_logo.png")} style={styles.logo} />
      <Text style={styles.title}>AA LIBRARY</Text>
      <TextInput style={styles.input} placeholder="AA Account" value={email} onChangeText={setEmail} />
      <TextInput style={styles.input} placeholder="Password" secureTextEntry value={password} onChangeText={setPassword} />
      <Button title="Login" onPress={() => navigation.navigate("Home")} />
    </View>
  );
}

// Home Page
function HomeScreen({ navigation }) {
  return (
    <View style={styles.container}>
      <Text style={styles.title}>HOME</Text>
      <Text style={styles.sectionTitle}>CURRENT BOOKING</Text>
      <Text style={styles.bookingText}>SEAT 3: 29/1/2025 10:00 - 14:00</Text>
      <Button title="Leaving Now" onPress={() => alert("Seat Released!")} />
      
      <Text style={styles.sectionTitle}>YOUR UPCOMING BOOKINGS</Text>
      <Text style={styles.bookingText}>BOOKING 2: SEAT 5 - 1/2/2025 10:00 - 12:00</Text>
      <Button title="Cancel" onPress={() => alert("Booking Canceled!")} />

      <Button title="Choose a Seat" onPress={() => navigation.navigate("SeatSelection")} />
    </View>
  );
}

// Seat Selection Page
function SeatSelectionScreen({ navigation }) {
  const [selectedSeat, setSelectedSeat] = useState(null);

  return (
    <View style={styles.container}>
      <Text style={styles.title}>SELECT A SEAT</Text>
      <View style={styles.seatGrid}>
        {[...Array(20).keys()].map((i) => (
          <TouchableOpacity
            key={i}
            style={[styles.seat, selectedSeat === i ? styles.selectedSeat : styles.availableSeat]}
            onPress={() => setSelectedSeat(i)}
          >
            <Text style={styles.seatText}>{selectedSeat === i ? "âœ”" : i + 1}</Text>
          </TouchableOpacity>
        ))}
      </View>
      <Button title="Next" onPress={() => navigation.navigate("TimeSelection")} />
    </View>
  );
}

// Time Selection Page
function TimeSelectionScreen({ navigation }) {
  return (
    <View style={styles.container}>
      <Text style={styles.title}>SELECT TIME</Text>
      <TextInput style={styles.input} placeholder="Start Time" />
      <TextInput style={styles.input} placeholder="End Time" />
      <Button title="Next" onPress={() => navigation.navigate("Confirmation")} />
    </View>
  );
}

// Confirmation Page
function ConfirmationScreen({ navigation }) {
  return (
    <View style={styles.container}>
      <Text style={styles.title}>CONFIRM BOOKING</Text>
      <Text style={styles.sectionTitle}>AA LIBRARY</Text>
      <Text style={styles.bookingText}>Please confirm your booking: SEAT 3 | 29/1/2025 | 10:00 - 14:00</Text>
      <Button title="Confirm" onPress={() => alert("Booking Confirmed!")} />
      <Button title="Back" onPress={() => navigation.goBack()} />
    </View>
  );
}

// Account Page
function AccountScreen() {
  return (
    <View style={styles.container}>
      <Image source={require("./assets/user.png")} style={styles.profilePic} />
      <Text style={styles.title}>CHOLE ZHOU</Text>
      <Text>Email: chole.zhou@aaschool.ac.uk</Text>
      <Button title="Sign Out" onPress={() => alert("Signed Out!")} />
    </View>
  );
}

// Navigation
export default function App() {
  return (
    <NavigationContainer>
      <Stack.Navigator>
        <Stack.Screen name="Login" component={LoginScreen} />
        <Stack.Screen name="Home" component={HomeScreen} />
        <Stack.Screen name="SeatSelection" component={SeatSelectionScreen} />
        <Stack.Screen name="TimeSelection" component={TimeSelectionScreen} />
        <Stack.Screen name="Confirmation" component={ConfirmationScreen} />
        <Stack.Screen name="Account" component={AccountScreen} />
      </Stack.Navigator>
    </NavigationContainer>
  );
}

// Styles
const styles = StyleSheet.create({
  container: { flex: 1, justifyContent: "center", alignItems: "center", backgroundColor: "#F5E6E0" },
  title: { fontSize: 24, fontWeight: "bold", marginBottom: 20 },
  sectionTitle: { fontSize: 18, fontWeight: "bold", marginTop: 20 },
  input: { width: 250, padding: 10, borderWidth: 1, borderColor: "#ccc", marginBottom: 10, backgroundColor: "#fff" },
  bookingText: { fontSize: 16, marginVertical: 10 },
  seatGrid: { flexDirection: "row", flexWrap: "wrap", justifyContent: "center", marginTop: 20 },
  seat: { width: 50, height: 50, margin: 5, justifyContent: "center", alignItems: "center", borderRadius: 10 },
  availableSeat: { backgroundColor: "green" },
  selectedSeat: { backgroundColor: "blue" },
  seatText: { color: "white", fontWeight: "bold" },
  logo: { width: 100, height: 100, marginBottom: 20 },
  profilePic: { width: 120, height: 120, borderRadius: 60, marginBottom: 20 },
});
